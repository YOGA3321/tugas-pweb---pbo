<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dokumentasi - Tugas 8 (P10) Unit Testing</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../../css/style.css">

    <style>
        .code-block-container {
            position: relative;
            margin-bottom: 20px;
        }
        .code-block-container button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
        }
        .code-block-container button:hover {
            background-color: var(--accent-color);
        }
    </style>
</head>
<body>

    <div class="container">
        <a href="../" class="tombol-kembali">‚Üê Kembali ke Daftar Tugas</a>

        <div class="konten-tugas">
            
            <h1>Tugas Pertemuan 10: Unit Testing dengan JUnit</h1>
            <h3>Nama: Ageng Prayogo</h3>
            <h3>NRP: 5025241225</h3>
            <h3>Kelas: B</h3>
            <p class="meta-info">Tugas ini bertujuan untuk mempraktikkan Test-Driven Development (TDD) dan Unit Testing menggunakan JUnit 4 di BlueJ untuk memvalidasi fungsionalitas kelas Product dan Review.</p>
            <hr>

            <h2>Deskripsi Proyek</h2>
            <p>Proyek ini terdiri dari tiga kelas: `Product`, `Review`, dan `ProductTest`. Kelas `ProductTest` berisi kumpulan skenario tes (metode dengan anotasi `@Test`) untuk memvalidasi setiap fungsionalitas di kelas `Product`. Ini memastikan bahwa metode seperti `addReview()`, `removeReview()`, dan lainnya berfungsi sesuai harapan dalam berbagai kondisi (valid, duplikat, invalid).</p>

            <h2>Hasil Aplikasi</h2>
            
            <h3>1. Diagram Kelas</h3>
            <img src="../../img/39.png" alt="Diagram Kelas Unit Testing" onclick="openModal(this)">
            <p class="caption">Diagram kelas yang menunjukkan hubungan antara `Product`, `Review`, dan `ProductTest`.</p>

            <h3>2. Hasil Eksekusi Unit Test</h3>
            <img src="../../img/40.png" alt="Hasil JUnit Test Results" onclick="openModal(this)">
            <p class="caption">Jendela "Test Results" dari JUnit yang menunjukkan semua 10 tes berhasil (bilah hijau) tanpa kegagalan.</p>
            
            <hr>

            <h2>Source Code</h2>
            <p>Berikut adalah kode sumber lengkap untuk 3 kelas yang digunakan dalam proyek ini.</p>

            <h3>Kelas: Product.java</h3>
            <p>Kelas utama yang menyimpan informasi produk dan mengelola daftar (`ArrayList`) objek `Review`.</p>
            <div class="code-block-container">
                <button onclick="copyCode(this, 'productCode')">Copy</button>
                <pre><code id="productCode">
import java.util.ArrayList;
import java.util.Iterator;

public class Product {
    private String productName;
    private int productPrice; // dalam sen
    private ArrayList<Review> reviewList;

    public Product(String productName, int productPrice) {
        this.productName = productName;
        this.productPrice = productPrice;
        reviewList = new ArrayList<Review>();
    }

    public String getProductName() {
        return productName;
    }

    public int getProductPrice() {
        return productPrice;
    }

    public int getReviewCount() {
        return reviewList.size();
    }

    public boolean addReview(String reviewer, String message, int stars) {
        if (isInvalidRating(stars)) {
            return false;
        }
        if (findReviewByAuthor(reviewer) != null) {
            return false;
        }
        reviewList.add(new Review(reviewer, message, stars));
        return true;
    }

    public void removeReview(int index) {
        if (index >= 0 && index < reviewList.size()) {
            reviewList.remove(index);
        }
    }

    public void likeReview(int index) {
        if (index >= 0 && index < reviewList.size()) {
            reviewList.get(index).upvote();
        }
    }

    public void dislikeReview(int index) {
        if (index >= 0 && index < reviewList.size()) {
            reviewList.get(index).downvote();
        }
    }

    public Review findMostLikedReview() {
        if (reviewList.isEmpty()) {
            return null;
        }
        Iterator<Review> it = reviewList.iterator();
        Review top = it.next();
        while (it.hasNext()) {
            Review current = it.next();
            if (current.getVoteCount() > top.getVoteCount()) {
                top = current;
            }
        }
        return top;
    }

    private boolean isInvalidRating(int stars) {
        return stars < 0 || stars > 5;
    }

    public Review findReviewByAuthor(String reviewer) {
        for (Review r : reviewList) {
            if (r.getReviewer().equals(reviewer)) {
                return r;
            }
        }
        return null;
    }

    private String formatPrice(int cents) {
        int dollars = cents / 100;
        int remain = cents % 100;
        if (remain < 10) {
            return "$" + dollars + ".0" + remain;
        } else {
            return "$" + dollars + "." + remain;
        }
    }
}
                </code></pre>
            </div>

            <h3>Kelas: Review.java</h3>
            <p>Kelas model sederhana yang menyimpan data untuk satu ulasan, termasuk voting (like/dislike).</p>
            <div class="code-block-container">
                <button onclick="copyCode(this, 'reviewCode')">Copy</button>
                <pre><code id="reviewCode">
public class Review {
    private String reviewer;
    private String message;
    private int rating;
    private int votes;

    public Review(String reviewer, String message, int rating) {
        this.reviewer = reviewer;
        this.message = message;
        this.rating = rating;
        this.votes = 0;
    }

    public String getReviewer() {
        return reviewer;
    }

    public String getMessage() {
        return message;
    }

    public int getRating() {
        return rating;
    }

    public int getVoteCount() {
        return votes;
    }

    public void upvote() {
        votes++;
    }

    public void downvote() {
        votes--;
    }

    public String getFullDetails() {
        return "Reviewer: " + reviewer + "\n" +
               "Rating: " + rating + "/5\n" +
               "Votes: " + votes + "\n" +
               "Review: " + message;
    }
}
                </code></pre>
            </div>

            <h3>Kelas: ProductTest.java</h3>
            <p>Kelas testing yang berisi semua skenario pengujian untuk memvalidasi fungsionalitas kelas `Product`.</p>
            <div class="code-block-container">
                <button onclick="copyCode(this, 'productTestCode')">Copy</button>
                <pre><code id="productTestCode">
import static org.junit.Assert.*;
import org.junit.Before;
import org.junit.Test;
import java.lang.reflect.Method;

public class ProductTest {
    private Product product;

    @Before
    public void setUp() {
        product = new Product("Ice Cream", 699);
    }

    @Test
    public void testGetProductNameAndPrice() {
        assertEquals("Ice Cream", product.getProductName());
        assertEquals(699, product.getProductPrice());
    }

    @Test
    public void testAddReviewValid() {
        boolean added = product.addReview("Dina", "Delicious!", 5);
        assertTrue(added);
        assertEquals(1, product.getReviewCount());
    }

    @Test
    public void testAddReviewDuplicateAuthor() {
        product.addReview("Dina", "Yummy!", 5);
        boolean addedAgain = product.addReview("Dina", "Still good!", 4);
        assertFalse(addedAgain);
        assertEquals(1, product.getReviewCount());
    }

    @Test
    public void testAddReviewInvalidRating() {
        boolean added = product.addReview("Tom", "Bad rating", 8);
        assertFalse(added);
        assertEquals(0, product.getReviewCount());
    }

    @Test
    public void testRemoveReview() {
        product.addReview("Dina", "Yummy!", 4);
        product.removeReview(0);
        assertEquals(0, product.getReviewCount());
    }

    @Test
    public void testRemoveReviewInvalidIndex() {
        product.addReview("Dina", "Yummy!", 4);
        product.removeReview(10);
        assertEquals(1, product.getReviewCount());
    }

    @Test
    public void testLikeAndDislikeReview() {
        product.addReview("Dina", "Yummy!", 5);
        product.likeReview(0);
        product.likeReview(0);
        product.dislikeReview(0);
        Review r = product.findReviewByAuthor("Dina");
        assertEquals(1, r.getVoteCount());
    }

    @Test
    public void testFindMostLikedReview() {
        product.addReview("Dina", "Yummy!", 5);
        product.addReview("Lina", "Fantastic!", 4);
        product.likeReview(1);
        Review best = product.findMostLikedReview();
        assertEquals("Lina", best.getReviewer());
    }

    @Test
    public void testFindReviewByAuthor() {
        product.addReview("Dina", "Yummy!", 4);
        Review r = product.findReviewByAuthor("Dina");
        assertNotNull(r);
        assertEquals("Dina", r.getReviewer());
        assertNull(product.findReviewByAuthor("Riko"));
    }

    @Test
    public void testPriceFormat() {
        try {
            java.lang.reflect.Method method = Product.class.getDeclaredMethod("formatPrice", int.class);
            method.setAccessible(true);
            String priceStr = (String) method.invoke(product, 699);
            assertEquals("$6.99", priceStr);

            priceStr = (String) method.invoke(product, 705);
            assertEquals("$7.05", priceStr);
        } catch (Exception e) {
            fail("Reflection error: " + e.getMessage());
        }
    }
}
                </code></pre>
            </div>

        </div>
    </div>
    
    <div id="myModal" class="modal" onclick="closeModal()">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <img class="modal-content" id="img01">
    </div>

    <script>
    function copyCode(button, elementId) {
        const codeElement = document.getElementById(elementId);
        navigator.clipboard.writeText(codeElement.innerText).then(function() {
            button.innerText = 'Copied!';
            setTimeout(function() { button.innerText = 'Copy'; }, 2000);
        }, function(err) {
            button.innerText = 'Gagal';
        });
    }

    var modal = document.getElementById('myModal');
    var modalImg = document.getElementById("img01");

    function openModal(element) {
        modal.style.display = "block";
        modal.style.opacity = "1";
        modalImg.src = element.src;
    }

    function closeModal() {
        modal.style.opacity = "0";
        setTimeout(function() {
            modal.style.display = "none";
        }, 300);
    }
    </script>
</body>
</html>